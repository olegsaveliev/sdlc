name: Module - AI Unit Tests

on:
  workflow_call:
    secrets:
      OPENAI_KEY:
        required: true

jobs:
  unit-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - uses: actions/setup-python@v4
        with: { python-version: '3.10' }
      
      - name: Install Dependencies
        run: |
          pip install -r requirements.txt
          pip install pytest httpx openai # Added openai here
      
      # NEW STEP: AI WRITES THE TESTS
      - name: ðŸ§  AI Generate Unit Tests
        env:
          OPENAI_KEY: ${{ secrets.OPENAI_KEY }}
        run: python scripts/generate_unit_tests.py
      
      # OLD STEP: RUN ALL TESTS (Includes the new AI one)
      - name: ðŸ§ª Run Tests
        run: |
          echo "Running tests..."
          pytest -v
