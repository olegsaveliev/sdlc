name: ðŸš€ Master Delivery Pipeline

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  # STEP 1: AI WRITES & RUNS UNIT TESTS
  call-quality:
    uses: ./.github/workflows/unit_tests.yml
    secrets:
      OPENAI_KEY: ${{ secrets.OPENAI_KEY }}

  # STEP 2: AI AUTOTESTS (REGRESSION) - Only on Merge
  call-ai-autotest:
    needs: call-quality
    if: github.event_name == 'push' && github.ref == 'refs/heads/main'
    uses: ./.github/workflows/auto_test.yml
    secrets:
      OPENAI_KEY: ${{ secrets.OPENAI_KEY }}

  # STEP 3: RELEASE
  call-staging:
    needs: call-ai-autotest
    uses: ./.github/workflows/3_staging.yml
